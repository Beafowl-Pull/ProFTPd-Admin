/**
 * ProFTPd Admin - Readme
 *
 * Graphical User Interface for ProFTPd with MySQL support
 *
 * @license http://www.gnu.org/licenses/gpl-2.0.txt GNU General Public License v2
 *
 * @copyright Ricardo Padilha <ricardo@droboports.com>
 * @copyright Christian Beer <djangofett@gmx.net>
 * @copyright Lex Brugman <lex_brugman@users.sourceforge.net>
 */

This program is free software; you can redistribute it and/or modify
it under the terms of the GNU General Public License version 2,
as published by the Free Software Foundation.

This program is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
GNU General Public License for more details.

You should have received a copy of the GNU General Public License
along with this program; if not, download from http://www.gnu.org/licenses/gpl-2.0.txt

Upgrade
-------
As the software has undergone a complete rewrite of the config file you
should not overwrite your old config.php and compare and change values manually.

Installation
------------

# Using MySQL:

1. Install ProFTPd with MySQL support
     - Debian: apt-get install proftpd-mysql
     - Gentoo: USE="mysql" emerge proftpd

2. Create a MySQL database (use something like phpMyAdmin for this), for example: "proftpd".

3. Use tables.sql to populate the database (you can use phpMyAdmin for this).

4. Add the following to your proftpd.conf (edit to your needs):
 SQLBackend                      mysql
 SQLConnectInfo                  database@localhost username password
 SQLAuthenticate                 on
 SQLAuthTypes                    Crypt   Backend
 SQLUserInfo                     users userid passwd uid gid homedir shell
 SQLGroupInfo                    groups groupname gid members
 SQLUserWhereClause              "disabled != 1"
 SQLLog PASS                     updatecount
 SQLNamedQuery                   updatecount UPDATE "login_count=login_count+1, last_login=now() WHERE userid='%u'" users
 # Used to track xfer traffic per user (without invoking a quota)
 SQLLog RETR                     bytes-out-count
 SQLNamedQuery                   bytes-out-count UPDATE "bytes_out_used=bytes_out_used+%b WHERE userid='%u'" users
 SQLLog RETR                     files-out-count
 SQLNamedQuery                   files-out-count UPDATE "files_out_used=files_out_used+1 WHERE userid='%u'" users

 SQLLog STOR                     bytes-in-count
 SQLNamedQuery                   bytes-in-count UPDATE "bytes_in_used=bytes_in_used+%b WHERE userid='%u'" users
 SQLLog STOR                     files-in-count
 SQLNamedQuery                   files-in-count UPDATE "files_in_used=files_in_used+1 WHERE userid='%u'" users

5. Extract all files to your webspace (into a subdirectory like "proftpdadmin").

6. Secure access to this directory (for example: create a .htaccess file if using apache)

7. Edit the configs/config_example.php file to your needs and rename it to config.php.

8. Start ProFTPd.

9. Go to http://yourwebspace/proftpdadmin/ and start using it!

# Using sqlite3:

1. Install ProFTPd with sqlite3 support

2. Use tables-sqlite3.sql to create an sqlite3 database:
   $ sqlite3 auth.sqlite3 < tables-sqlite3.sql

3. Add the following to your proftpd.conf (edit to your needs):

  AuthOrder               mod_sql.c mod_auth_unix.c
  SQLDefaultUID           99
  SQLDefaultGID           99
  SQLMinUserUID           999
  SQLMinUserGID           999
  
  SQLBackend              sqlite3
  SQLEngine               on
  SQLAuthenticate         on
  SQLConnectInfo          /path/to/auth.sqlite3
  SQLUserInfo             users userid passwd uid gid homedir shell
  SQLGroupInfo            groups groupname gid members
  SQLUserWhereClause      "disabled != 1"
  SQLLog PASS             updatecount
  SQLNamedQuery           updatecount UPDATE "login_count=login_count+1, last_login=datetime() WHERE userid='%u'" users
  
  SQLPasswordEngine       on
  SQLPasswordPBKDF2       sha1 5000 20
  SQLPasswordUserSalt     name Prepend
  SQLAuthTypes            pbkdf2
  SQLPasswordEncoding     hex
  
  # Used to track xfer traffic per user (without invoking a quota)
  SQLLog RETR             bytes-out-count
  SQLNamedQuery           bytes-out-count UPDATE "bytes_out_used=bytes_out_used+%b WHERE userid='%u'" users
  SQLLog RETR             files-out-count
  SQLNamedQuery           files-out-count UPDATE "files_out_used=files_out_used+1 WHERE userid='%u'" users
  
  SQLLog STOR             bytes-in-count
  SQLNamedQuery           bytes-in-count UPDATE "bytes_in_used=bytes_in_used+%b WHERE userid='%u'" users
  SQLLog STOR             files-in-count
  SQLNamedQuery           files-in-count UPDATE "files_in_used=files_in_used+1 WHERE userid='%u'" users

5. Extract all files to your webspace (into a subdirectory like "proftpdadmin").

6. Secure access to this directory (for example: create a .htaccess file if using apache)

7. Edit the configs/config_example.php file to your needs and rename it to config.php.

8. Start ProFTPd.

9. Go to http://yourwebspace/proftpdadmin/ and start using it!

Thanks / Links
--------------

Lex Brugman for initiating this project  
Justin Vincent for the ezSQL library